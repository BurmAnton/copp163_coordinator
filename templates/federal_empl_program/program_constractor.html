{% extends "layout.html" %}
{% load static %}
{% load fed_extras %}

{% block title %}Конструктор программы{% endblock %}
{% block style %}
    <link href="{% static 'federal_empl_program/css/program_constractor.css' %}" rel="stylesheet">
{% endblock %}
{% block script %}
     <script src="{% static 'federal_empl_program/js/program_constractor.js' %}" rel="stylesheet"></script> 
{% endblock %}

{% block body %}
    <!-- Models -->
    <div class="modal fade add-standart-modal" id="AddAuthorModal" tabindex="-1" aria-labelledby="AddAuthorModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="AddAuthorModalLabel">Добавить разработчика</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form action="{% url 'program_constractor' program.id %}" method="post">
                    <div class="modal-body">
                        <div class="form-floating mb-3">
                            <input type="input" class="form-control" id="AuthorNameInput" name="name" placeholder="" maxlength="600" required>
                            <label for="AuthorNameInput">ФИО</label>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="input" class="form-control" id="AuthordDegreeInput" name="degree" placeholder=""  maxlength="250">
                            <label for="AuthordDegreeInput">Учёная степень</label>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="input" class="form-control" id="AuthorPositionInput" name="position" placeholder=""  maxlength="600" required>
                            <label for="AuthorPositionInput">Должность</label>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="input" class="form-control" id="AuthorWorkInput" name="place_of_work" placeholder=""  maxlength="600" required>
                            <label for="AuthorWorkInput">Место работы</label>
                        </div>
                    </div> 
                    <div class="modal-footer">
                        <div class="d-grid gap-2">
                            <input type="submit" class="btn btn-primary" name="create-author" value="Добавить">
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="modal fade add-standart-modal" id="AddStandartModal" tabindex="-1" aria-labelledby="AddStandartModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="AddStandartModalLabel">Добавить ФГОС</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form action="{% url 'program_constractor' program.id %}" method="post">
                    <div class="modal-body">
                        <div class="form mb-3 filter-selectpicker">
                            <select class="selectpicker w-100" id="StandartTypeInput" title="Тип ФГОС" data-live-search="true" name="standart_type" required>
                                <option value="SPO" selected>ФГОС СПО</option>
                                <option value="VO">ФГОС ВО</option>
                            </select>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="input" class="form-control" id="StandartCodeInput" name="code" maxlength="20" required>
                            <label for="StandartCodeInput">Код</label>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="input" class="form-control" id="StandartNameInput" name="name" maxlength="350" required>
                            <label for="StandartNameInput">Название ФГОС</label>
                        </div>
                    </div> 
                    <div class="modal-footer">
                        <div class="d-grid gap-2">
                            <input type="submit" class="btn btn-primary" name="add-standart-program" value="Добавить ФГОС">
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="modal fade add-competence-equipment-modal" id="AddEquipmentModal" tabindex="-1" aria-labelledby="AddEquipmentModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="AddEquipmentModalLabel">Добавить МТО</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form action="{% url 'program_constractor' program.id %}" method="post">
                    <div class="modal-body">
                        <div class="form-floating mb-3 filter-selectpicker">
                            <select class="selectpicker w-100" id="EquipmentCompetenciesInput" title="Выберите компетенции" name="competencies" data-live-search="true" multiple required>
                                {% for activity in program.activities.all %}
                                    {% for competence in activity.competencies.all %} 
                                        <option value="{{ competence.id }}">{{ competence }}</option>
                                    {% endfor %}
                                {% endfor %}
                            </select>
                            <label for="EquipmentCompetenciesInput">Компетенции</label>
                        </div>
                        <div class="form">
                            <label for="EquipmentInput">Материально-техническое обеспечение</label>
                            <textarea class="form-control" name="name" style="height: 240px" id="EquipmentInput" required></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <div class="d-grid gap-2">
                            <input type="submit" class="btn btn-primary" name="add-equipment" value="Добавить">
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    {% for activity in program.activities.all %}
        <div class="modal fade change-activity-modal" id="ChangeActivityModal{{activity.id}}" tabindex="-1" aria-labelledby="ChangeActivityModal{{activity.id}}Label" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="ChangeActivityModal{{activity.id}}Label">Изменить Вид деятельности</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <form action="{% url 'program_constractor' program.id %}" method="post">
                        <div class="modal-body">
                            <input type="input" class="form-control" name="activity_id" value="{{ activity.id }}" style="display: none;" required>
                            <div class="form-floating mb-3">
                                <input type="input" class="form-control" id="Activity{{activity.id}}ChangeInput" placeholder="" name="name" value="{{ activity.name }}" maxlength="350" required>
                                <label for="Activity{{activity.id}}ChangeInput">Вид деятельности</label>
                            </div>
                        </div> 
                        <div class="modal-footer" style="display: flex; flex-direction: row-reverse; justify-content: space-between;">
                            <input type="submit" class="btn btn-primary" name="change-activity" value="Сохранить">
                            </form>
                            <form action="{% url 'program_constractor' program.id %}" method="post"> 
                                <input type="input" class="form-control" name="activity_id" value="{{ activity.id }}" style="display: none;" required>
                                <input type="submit" class="btn btn-danger" name="delete-activity" value="Удалить">
                            </form>
                        </div>
                </div>
            </div>
        </div>
        <div class="modal fade add-competence-modal" id="AddCompetenceModal{{activity.id}}" tabindex="-1" aria-labelledby="AddCompetenceModal{{activity.id}}Label" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="AddCompetenceModal{{activity.id}}Label">Добавить компетенцию</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <form action="{% url 'program_constractor' program.id %}" method="post">
                        <div class="modal-body">
                            <input type="input" class="form-control" name="activity_id" value="{{ activity.id }}" style="display: none;" required>
                            <div class="form-floating mb-3">
                                <input type="input" class="form-control" id="Competence{{activity.id}}Input" placeholder="" name="name" maxlength="350" required>
                                <label for="Competence{{activity.id}}Input">Название компетенции</label>
                            </div>
                            <div class="form-floating mb-3">
                                <input type="input" class="form-control" id="Competence{{activity.id}}Input" placeholder="" name="function_code" maxlength="20" required>
                                <label for="Competence{{activity.id}}Input">Код трудовой функции</label>
                            </div>
                            <div class="form-floating mb-3">
                                <input type="input" class="form-control" id="Competence{{activity.id}}Input" placeholder="" name="function_name" maxlength="350" required>
                                <label for="Competence{{activity.id}}Input">Название трудовой функции</label>
                            </div>
                        </div> 
                        <div class="modal-footer">
                            <div class="d-grid gap-2">
                                <input type="submit" class="btn btn-primary" name="add-competence" value="Добавить компетенцию">
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        {% for competence in activity.competencies.all %} 
            <div class="modal fade change-competence-modal" id="ChangeCompetenceModal{{competence.id}}" tabindex="-1" aria-labelledby="ChangeCompetenceModal{{competence.id}}Label" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="ChangeCompetenceModal{{competence.id}}Label">Изменить компетенцию</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <form action="{% url 'program_constractor' program.id %}" method="post">
                            <div class="modal-body">
                                <input type="input" class="form-control" name="competence_id" value="{{ competence.id }}" style="display: none;" required>
                                <div class="form-floating mb-3 filter-selectpicker" {% if program.activities.all.count < 2 or program.program_type == "DPOPK" %}style="display: none;"{% endif %}>
                                    <select class="selectpicker w-100" title="Профстандарт" data-live-search="true" id="CompetenceActivityInput" name="activity_id" required>
                                        {%for activity in program.activities.all %}  
                                            {% if competence.activity == activity %}
                                                <option value="{{activity.id}}" class="field" selected>{{ activity }}</option>
                                            {% else %}
                                                <option value="{{activity.id}}" class="field">{{ activity }}</option>
                                            {% endif %}
                                        {% endfor %}
                                    </select>
                                    <label for="CompetenceActivityInput">Вид деятельности</label>
                                </div>
                                <div class="form-floating mb-3">
                                    <input type="input" class="form-control" id="Competence{{competence.id}}ChangeInput" placeholder="" name="name" value="{{ competence.name }}" maxlength="350" required>
                                    <label for="Competence{{competence.id}}ChangeInput">Название компетенции</label>
                                </div>
                                <div class="form-floating mb-3">
                                    <input type="input" class="form-control" id="Competence{{competence.id}}ChangeInput" placeholder="" name="function_code" value="{{ competence.function_code }}" maxlength="20" required>
                                    <label for="Competence{{competence.id}}ChangeInput">Код трудовой функции</label>
                                </div>
                                <div class="form-floating mb-3">
                                    <input type="input" class="form-control" id="Competence{{competence.id}}ChangeInput" placeholder="" name="function_name" value="{{ competence.function_name }}" maxlength="350" required>
                                    <label for="Competence{{competence.id}}ChangeInput">Название трудовой функции</label>
                                </div>
                            </div> 
                            <div class="modal-footer" style="display: flex; flex-direction: row-reverse; justify-content: space-between;">
                                <input type="submit" class="btn btn-primary" name="change-competence" value="Изменить компетенцию">
                                </form>
                                <form action="{% url 'program_constractor' program.id %}" method="post"> 
                                    <input type="input" class="form-control" name="competence_id" value="{{ competence.id }}" style="display: none;" required>
                                    <input type="submit" class="btn btn-danger" name="delete-competence" value="Удалить">
                                </form>
                            </div>
                    </div>
                </div>
            </div>
            <div class="modal fade add-competence-indicators-modal" id="AddIndicatorsModal{{competence.id}}" tabindex="-1" aria-labelledby="AddIndicatorsModal{{competence.id}}Label" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="AddIndicatorsModal{{competence.id}}Label">Добавить знания и умения компетенции</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <form action="{% url 'program_constractor' program.id %}" method="post">
                            <div class="modal-body">
                                <input type="input" class="form-control" name="competence_id" value="{{ competence.id }}" style="display: none;" required>
                                <div class="form-floating mb-3">
                                    <input type="input" class="form-control" id="knowledge{{competence.id}}Input" placeholder="" name="knowledge" maxlength="350" required>
                                    <label for="knowledge{{competence.id}}Input">Знание</label>
                                </div>
                                <div class="form-floating mb-3">
                                    <input type="input" class="form-control" id="skill{{competence.id}}Input" placeholder="" name="skill" maxlength="350" required>
                                    <label for="skill{{competence.id}}Input">Умение</label>
                                </div>
                                <div class="form-floating mb-3">
                                    <input type="input" class="form-control" id="practice{{competence.id}}Input" placeholder="" name="practice" maxlength="350">
                                    <label for="practice{{competence.id}}Input">Практический опыт (при наличии)</label>
                                </div>
                            </div> 
                            <div class="modal-footer">
                                <div class="d-grid gap-2">
                                    <input type="submit" class="btn btn-primary" name="add-indicator" value="Добавить компетенцию">
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            {% for indicator in competence.indicators.all %}
                <div class="modal fade change-competence-modal" id="ChangeIndicatorsModal{{indicator.id}}" tabindex="-1" aria-labelledby="ChangeIndicatorsModal{{indicator.id}}Label" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="ChangeIndicatorsModal{{indicator.id}}Label">Изменить компетенцию</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <form action="{% url 'program_constractor' program.id %}" method="post">
                                <div class="modal-body">
                                    <input type="input" class="form-control" name="indicator_id" value="{{ indicator.id }}" style="display: none;" required>
                                        <div class="form-floating mb-3">
                                        <input type="input" class="form-control" id="knowledge{{indicator.id}}Input" placeholder="" name="knowledge" value="{{ indicator.knowledge }}" maxlength="350" required>
                                        <label for="knowledge{{indicator.id}}ChangeInput">Знание</label>
                                    </div>
                                    <div class="form-floating mb-3">
                                        <input type="input" class="form-control" id="skill{{indicator.id}}Input" placeholder="" name="skill" value="{{ indicator.skill }}" maxlength="350" required>
                                        <label for="skill{{indicator.id}}ChangeInput">Умение</label>
                                    </div>
                                    <div class="form-floating mb-3">
                                        <input type="input" class="form-control" id="practice{{indicator.id}}Input" placeholder="" name="practice" value="{{ indicator.practice }}" maxlength="350">
                                        <label for="practice{{indicator.id}}ChangeInput">Практический опыт (при наличии)</label>
                                    </div>
                                </div> 
                                <div class="modal-footer" style="display: flex; flex-direction: row-reverse; justify-content: space-between;">
                                    <input type="submit" class="btn btn-primary" name="change-indicator" value="Сохранить">
                                    </form>
                                    <form action="{% url 'program_constractor' program.id %}" method="post"> 
                                        <input type="input" class="form-control" name="indicator_id" value="{{ indicator.id }}" style="display: none;" required>
                                        <input type="submit" class="btn btn-danger" name="delete-indicator" value="Удалить">
                                    </form>
                                </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        {% endfor %}
    {% endfor %}
    {% for module in program.modules.all %}
        <div class="modal fade add-subject-modal" id="AddSubjectModal{{module.id}}" tabindex="-1" aria-labelledby="AddSubjectModal{{module.id}}Label" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="AddSubjectModal{{module.id}}Label">Добавить тему</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <form action="{% url 'program_constractor' program.id %}" method="post">
                        <div class="modal-body">
                            <input style="display: none;" type="input" class="form-control" name="module_id" value="{{module.id}}" equired>
                            <div class="form-floating mb-3">
                                <input type="input" class="form-control" id="subjectName{{module.id}}Input" name="name" maxlength="350" placeholder="" required>
                                <label for="subjectName{{module.id}}Input">Название темы</label>
                            </div>
                            <div class="form-floating mb-3">
                                <input type="input" class="form-control" id="subjectName{{module.id}}Input" name="attest_form" maxlength="100" placeholder="">
                                <label for="subjectName{{module.id}}Input">Форма аттестации</label>
                            </div>
                            <div class="form-floating mb-3">
                                <input type="number" class="form-control" id="subjectLectionDuration{{module.id}}Input" name="lections_duration" value=0 required>
                                <label for="subjectLectionDuration{{module.id}}Input">Лекции (ак. часы)</label>
                            </div>
                            <div class="form-floating">
                                <textarea class="form-control" name="lections" style="height: 80px" id="subjectLection{{module.id}}Input"></textarea>
                                <label for="subjectLection{{module.id}}Input">Лекции (содержание)</label>
                            </div>
                            <div class="form-floating mb-3">
                                <input type="number" class="form-control" id="subjectPracticeDuration{{module.id}}Input" name="practice_duration" value=0  required>
                                <label for="subjectPracticeDuration{{module.id}}Input">Практика (ак. часы)</label>
                            </div>
                            <div class="form-floating">
                                <textarea class="form-control" name="practice" style="height: 80px" id="subjectPractice{{module.id}}Input"></textarea>
                                <label for="subjectPractice{{module.id}}Input">Практика (содержание)</label>
                            </div>
                            <div class="form-floating mb-3">
                                <input type="number" class="form-control" id="subjectConsultationsDuration{{module.id}}Input" name="consultations_duration" value=0  required>
                                <label for="subjectConsultationsDuration{{module.id}}Input">Консультации (ак. часы)</label>
                            </div>
                            <div class="form-floating">
                                <textarea class="form-control" name="consultations" style="height: 80px" id="subjectConsultations{{module.id}}Input"></textarea>
                                <label for="subjectConsultations{{module.id}}Input">Консультации (содержание)</label>
                            </div>
                            <div class="form-floating mb-3">
                                <input type="number" class="form-control" id="subjectIndependentDuration{{module.id}}Input" name="independent_duration" value=0  required>
                                <label for="subjectIndependentDuration{{module.id}}Input">Самостоятельная работа (ак. часы)</label>
                            </div>
                            <div class="form-floating">
                                <textarea class="form-control" name="independent" style="height: 80px" id="subjectIndependent{{module.id}}Input"></textarea>
                                <label for="subjectIndependent{{module.id}}Input">Самостоятельная работа (содержание)</label>
                            </div>
                        </div> 
                        
                        <div class="modal-footer">
                            <div class="d-grid gap-2">
                                <input type="submit" class="btn btn-primary" name="add-subject" value="Добавить">
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>     
        <div class="modal fade add-interim-ex-modal" id="AddInterimExModal{{module.id}}" tabindex="-1" aria-labelledby="AddInterimExModal{{module.id}}Label" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="AddInterimExModal{{module.id}}Label">Промежуточная аттестация</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <form action="{% url 'program_constractor' program.id %}" method="post">
                    <div class="modal-body">
                        <input style="display: none;" type="input" class="form-control" name="module_id" value="{{module.id}}" role=""equired>
                        <div class="form-floating mb-3">
                            <input type="input" class="form-control" id="subjectName{{module.id}}Input" name="attest_form" value="{{module.attest_form|default_if_none:''}}" maxlength="100" placeholder="" required>
                            <label for="subjectName{{module.id}}Input">Форма промежуточной аттестации</label>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="number" class="form-control" id="subjectLectionDuration{{module.id}}Input" name="lections_duration" value="{{module.lections_duration}}" required>
                            <label for="subjectLectionDuration{{module.id}}Input">Лекции (ак. часы)</label>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="number" class="form-control" id="subjectPracticeDuration{{module.id}}Input" name="practice_duration" value="{{module.practice_duration}}" required>
                            <label for="subjectPracticeDuration{{module.id}}Input">Практика (ак. часы)</label>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="number" class="form-control" id="subjectConsultationsDuration{{module.id}}Input" name="consultations_duration" value="{{module.consultations_duration}}" required>
                            <label for="subjectConsultationsDuration{{module.id}}Input">Консультации (ак. часы)</label>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="number" class="form-control" id="subjectIndependentDuration{{module.id}}Input" name="independent_duration" value="{{module.independent_duration}}" required>
                            <label for="subjectIndependentDuration{{module.id}}Input">Самостоятельная работа (ак. часы)</label>
                        </div>
                    </div> 
                    <div class="modal-footer" style="display: flex; flex-direction: row-reverse; justify-content: space-between;">
                        <input type="submit" class="btn btn-primary" name="add-interim-ex" value="Сохранить">
                        </form>
                        <form action="{% url 'program_constractor' program.id %}" method="post"> 
                            <input type="input" class="form-control" name="module_id" value="{{ module.id }}" style="display: none;" required>
                            <input type="submit" class="btn btn-danger" name="delete-interim-ex" value="Удалить">
                        </form>
                    </div>
                </div>
            </div>
        </div> 
        {% for subject in module.subjects.all %}
            <div class="modal fade change-subject-modal" id="ChangeSubjectModal{{subject.id}}" tabindex="-1" aria-labelledby="ChangeSubjectModal{{subject.id}}Label" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="ChangeSubjectModal{{subject.id}}Label">Изменить тему</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <form action="{% url 'program_constractor' program.id %}" method="post">
                        <div class="modal-body">
                            <input style="display: none;" type="input" class="form-control" name="subject_id" value="{{subject.id}}" required>
                            <div class="form-floating mb-3">
                                <input type="input" class="form-control" id="subjectName{{module.id}}InputChange" name="name" value="{{subject.name}}" maxlength="350" placeholder="" required>
                                <label for="subjectName{{module.id}}InputChange">Название темы</label>
                            </div>
                            <div class="form-floating mb-3">
                                <input type="input" class="form-control" id="subjectName{{module.id}}InputChange" name="attest_form" value="{{subject.attest_form}}" maxlength="100" placeholder="">
                                <label for="subjectName{{module.id}}InputChange">Форма аттестации</label>
                            </div>
                            <div class="form-floating mb-3">
                                <input type="number" class="form-control" id="subjectLectionDuration{{module.id}}InputChange" name="lections_duration" value="{{subject.lections_duration}}" required>
                                <label for="subjectLectionDuration{{module.id}}InputChange">Лекции (ак. часы)</label>
                            </div>
                            <div class="form-floating">
                                <textarea class="form-control" name="lections" style="height: 80px" id="subjectLection{{module.id}}InputChange">{{subject.lections}}</textarea>
                                <label for="subjectLection{{module.id}}InputChange">Лекции (содержание)</label>
                            </div>
                            <div class="form-floating mb-3">
                                <input type="number" class="form-control" id="subjectPracticeDuration{{module.id}}InputChange" name="practice_duration" value="{{subject.practice_duration}}"  required>
                                <label for="subjectPracticeDuration{{module.id}}InputChange">Практика (ак. часы)</label>
                            </div>
                            <div class="form-floating">
                                <textarea class="form-control" name="practice" style="height: 80px" id="subjectPractice{{module.id}}InputChange">{{subject.practice}}</textarea>
                                <label for="subjectPractice{{module.id}}InputChange">Практика (содержание)</label>
                            </div>
                            <div class="form-floating mb-3">
                                <input type="number" class="form-control" id="subjectConsultationsDuration{{module.id}}InputChange" name="consultations_duration" value="{{subject.consultations_duration}}"  required>
                                <label for="subjectConsultationsDuration{{module.id}}InputChange">Консультации (ак. часы)</label>
                            </div>
                            <div class="form-floating">
                                <textarea class="form-control" name="consultations" style="height: 80px" id="subjectConsultations{{module.id}}InputChange">{{subject.consultations}}</textarea>
                                <label for="subjectConsultations{{module.id}}InputChange">Консультации (содержание)</label>
                            </div>
                            <div class="form-floating mb-3">
                                <input type="number" class="form-control" id="subjectIndependentDuration{{module.id}}InputChange" name="independent_duration" value="{{subject.independent_duration}}"  required>
                                <label for="subjectIndependentDuration{{module.id}}InputChange">Самостоятельная работа (ак. часы)</label>
                            </div>
                            <div class="form-floating">
                                <textarea class="form-control" name="independent" style="height: 80px" id="subjectIndependent{{module.id}}InputChange">{{subject.independent}}</textarea>
                                <label for="subjectIndependent{{module.id}}InputChange">Самостоятельная работа (содержание)</label>
                            </div>
                        </div> 
                
                        <div class="modal-footer" style="display: flex; flex-direction: row-reverse; justify-content: space-between;">
                            <input type="submit" class="btn btn-primary" name="change-subject" value="Сохранить">
                            </form>
                            <form action="{% url 'program_constractor' program.id %}" method="post"> 
                                <input type="input" class="form-control" name="subject_id" value="{{ subject.id }}" style="display: none;" required>
                                <input type="submit" class="btn btn-danger" name="delete-subject" value="Удалить">
                            </form>
                        </div>
                    </div>
                </div>
            </div> 
        {% endfor %}
    {% endfor %}
    <div class="modal fade add-ex-modal" id="AddExModal" tabindex="-1" aria-labelledby="AddExModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="AddExModalLabel">Итоговая аттестацию</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form action="{% url 'program_constractor' program.id %}" method="post">
                    <div class="modal-body">
                        <div class="form-floating mb-3">
                            <input type="input" class="form-control" id="subjectName{{module.id}}Input" name="attest_form" value="{{ program.exam_attest_form|default_if_none:'' }}" maxlength="100" placeholder="" required>
                            <label for="subjectName{{module.id}}Input">Форма итоговой аттестации</label>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="number" class="form-control" id="subjectLectionDuration{{module.id}}Input" name="lections_duration" value="{{ program.exam_lections_duration }}" required>
                            <label for="subjectLectionDuration{{module.id}}Input">Лекции (ак. часы)</label>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="number" class="form-control" id="subjectPracticeDuration{{module.id}}Input" name="practice_duration" value="{{ program.exam_practice_duration }}"  required>
                            <label for="subjectPracticeDuration{{module.id}}Input">Практика (ак. часы)</label>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="number" class="form-control" id="subjectConsultationsDuration{{module.id}}Input" name="consultations_duration" value="{{ program.exam_consultations_duration }}"  required>
                            <label for="subjectConsultationsDuration{{module.id}}Input">Консультации (ак. часы)</label>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="number" class="form-control" id="subjectIndependentDuration{{module.id}}Input" name="independent_duration" value="{{ program.exam_independent_duration }}"  required>
                            <label for="subjectIndependentDuration{{module.id}}Input">Самостоятельная работа (ак. часы)</label>
                        </div>
                    </div> 
                    
                    <div class="modal-footer">
                        <div class="d-grid gap-2">
                            <input type="submit" class="btn btn-primary" name="add-ex" value="Сохранить">
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="modal fade import-modal" id="ImportModal" tabindex="-1" aria-labelledby="ImportModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="ImportModalLabel">Импорт учебного плана плана</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form action="{% url 'program_constractor' program.id %}" method="post" enctype="multipart/form-data">
                    <div class="modal-body">
                        <div class="alert alert-danger w-90" role="alert">
                            После нажатия кнопки "Импортировать" текущие данные на вкладке "Учебный план" будут удалены и заменены на данные из импортируемого файла.
                        </div>
                        <div class="mb-3">
                            {% csrf_token %}
                            {{ form.non_field_errors }}
                            {{ form.import_file.help_text }}
                            {{ form.import_file.errors }}
                            {{ form.import_file }}
                        </div>
                        <a href="https://docs.google.com/spreadsheets/d/1bLAVjb62rZFQ869Byx_2ACzdLg2MpgcW6J19Y6l5nMk/edit#gid=0" target="_blank" rel="noopener noreferrer">шаблон для импорта</a>
                    </div> 
                    <div class="modal-footer">
                        <div class="d-grid gap-2">
                            <input type="submit" class="btn btn-primary" name="import-competencies" value="Импортировать">
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!-- !Models -->

    <div class="page-hdr">
        <h1>Конструктор программы</h1>
        <h3 class="stage-h3">{{program.get_program_type_display}} {{program}} ({{program.duration}})</h3>
    </div>
    <div class="stages">
        <div class="tabs-panel">
            <div class="tabs">
                {% for stage in stages %}
                    {% if stage.0 != 5 %}
                        <a data-stage="{{ stage.0 }}" class="stage-btn btn {%if current_stage == stage.0 %}btn-primary{%elif  stage.0|check_stage:program.status %} disabled{%else%}btn-outline-primary{%endif%}">{{ stage.1 }}</a>
                    {% endif %}
                {% endfor %}
            </div>
            {% if program.status == "6"%}
                <div>
                    <form action="{% url 'program_constractor' program.id %}" method="post">
                        <button class="btn btn-primary" name="generate-program">Сгенерировать программу</button>
                    </form>
                </div>
            {% endif %}
        </div>
        <div class="stage stage-1" data-stage="1" {% if current_stage == 1 %}style="display:block;"{%else%}style="display:none;"{%endif%}>
            <form action="{% url 'program_constractor' program.id %}" method="post">
                <div class="stage-hdr">
                    <h2>
                        {% if program.status != "1" %}
                            <img class="check-img" src="{% static 'education_centers/img/check.png' %}" alt="check-icon">
                        {% else %}
                            1. 
                        {% endif %}
                        Общие сведения о программе
                    </h2>
                    {% if program.status == "0" or program.status == "1" %}
                        <button class="btn btn-primary" name="save-stage" value="1">Сохранить</button>
                    {% else %}
                        <button class="btn btn-outline-primary" name="save-stage" value="1">Сохранить изменения</button>
                    {% endif %}
                </div>
                <div class="form-floating mb-3">
                    <input type="input" class="form-control disabled" id="ProgramNameInput" name="name" maxlength="250" value="{{program.name}}" disabled>
                    <label for="ProgramNameInput">Название программы</label>
                </div>
                <div style="display: flex; gap: 5px;">
                    <div class="form-floating mb-3" style="width: 100%;">
                        <input type="input" class="form-control disabled" id="ProgramTypeInput" name="program_type" maxlength="5" value="{{program.get_program_type_display}}" disabled>
                        <label for="ProgramTypeInput">Тип программы</label>
                    </div>
                    <div class="form-floating mb-3" style="width: 100%;">
                        <input type="input" class="form-control disabled" id="EducationFormInput" name="education_form" maxlength="5" value="{{program.get_education_form_display}}" disabled>
                        <label for="EducationFormInput">Форма обучения</label>
                    </div>
                    <div class="form-floating mb-3" style="width: 100%;">
                        <input type="input" class="form-control disabled" id="ProgramDurationInput" name="duration" maxlength="5" value="{{program.duration}}" disabled>
                        <label for="ProgramDurationInput">Длительность (ак. часов)</label>
                    </div>
                </div>
                <div class="select-add">
                    <div class="form-floating mb-3 filter-selectpicker">
                        <select class="selectpicker w-100" title="ФГОС Стандарт" id="StandartInput" data-live-search="true" name="standart" required>
                            {% if program.standart != None %}
                                <option value="{{program.standart.id}}" class="field" selected>{{program.standart}} ({{program.standart.get_standart_type_display}})</option>
                            {% endif %}
                            {%for standart in standarts %}  
                                <option value="{{standart.id}}" class="field">{{standart}}  ({{standart.get_standart_type_display}})</option>
                            {% endfor %}
                        </select>
                        <label for="StandartInput">ФГОС</label>
                    </div>
                    <div class="btn btn-outline-primary add-btn" data-bs-toggle="modal" data-bs-target="#AddStandartModal">+</div>
                </div>
                <div class="form-floating mb-3 filter-selectpicker">
                    <select class="selectpicker w-100" title="Профстандарт" data-live-search="true" id="ProfstandartInput" name="profstandart" required>
                        {% if program.profstandart != None %}
                            <option value="{{program.profstandart.id}}" class="field" selected>{{program.profstandart.prof_field.code}}.{{program.profstandart.code}} {{program.profstandart.name}}</option>
                        {% endif %}
                        {%for profstandart in profstandarts %}  
                            <option value="{{profstandart.id}}" class="field">{{profstandart.prof_field.code}}.{{profstandart.code}} {{profstandart.name}}</option>
                        {% endfor %}
                    </select>
                    <label for="ProfstandartInput">Профстандарт</label>
                </div>
                
                <div class="form mb-3" style="width: 100%; {%if program.program_type == "DPOPK" %}display: none;{% endif %}">
                    <label for="QualLevelInput">Уровень квалификации в соответствии с профессиональным стандартом</label>
                    <input type="input" class="form-control" id="QualLevelInput" name="qual_level" maxlength="20" value="{{program.qual_level|default_if_none:''}}" placeholder="" {%if program.program_type != "DPOPK" %}required{% endif %}>
                    {% if program.program_type == "DPOPP" %}
                        <div class="alert alert-info w-90" role="alert" style="margin-top: 5px;">
                            Указывается в соответствии с уровнями квалификаций в целях разработки проектов профессиональных стандартов (приказ Минтруда России от 12 апреля 2013 г. № 148н).
                        </div>
                    {% endif %}
                </div>   
                
                <div class="form mb-3" {%if program.program_type == "DPOPK" %} style="display: none;"{% endif %}>
                    <label for="AssignedQualifInput">Наименование присваиваемой квалификации</label>
                    <input type="input" class="form-control" id="AssignedQualifInput" placeholder="" value="{{ program.assigned_qualif|default_if_none:'' }}" name="assigned_qualif" maxlength="250"  {%if program.program_type != "DPOPK" %}required{% endif %}>
                    {% if program.program_type == "DPOPP" %}
                        <div class="alert alert-info w-90" role="alert" style="margin-top: 5px;">
                            При разработке программы ПП на основе профессионального стандарта наименование новой квалификации определяется наименованием соответствующего профессионального стандарта.
                        </div>
                    {% elif program.program_type != "DPOPK" %}
                        <div class="alert alert-info w-90" role="alert" style="margin-top: 5px;">
                            При разработке программы профессионального обучения на основе профессионального стандарта наименование новой квалификации определяется наименованием соответствующего профессионального стандарта (при наличии).
                        </div>
                    {% endif %}
                </div>
                <div class="form" style="margin-bottom: 15px; {%if program.program_type == "DPOPK" %}display: none;{% endif %}">
                    <label for="GenFunctionsInput">Обобщенные трудовые функции (из раздела II выбранного профстандарта)</label>
                    <textarea class="form-control" name="gen_functions" style="height: 120px" id="GenFunctionsInput"  {%if program.program_type != "DPOPK" %}required{% endif %}>{{program.gen_functions|default_if_none:''}}</textarea>
                </div>
                
                <h3 style="margin-bottom: 15px;">Оценочные материалы</h3>
                <div class="form" style="margin-bottom: 15px;">
                    <label for="GenFunctionsInput">Описание требований к проведению Текущей Аттестации, критерии оценивания</label>
                    <textarea class="form-control" name="current_control" style="height: 120px" id="GenFunctionsInput" required>{{program.current_control|default_if_none:''}}</textarea>
                </div>
                <div class="form" style="margin-bottom: 15px;">
                    <label for="GenFunctionsInput">Описание требований к выполнению заданий Промежуточной Аттестации, критерии оценивания</label>
                    <textarea class="form-control" name="middle_control" style="height: 120px" id="GenFunctionsInput" required>{{program.middle_control|default_if_none:''}}</textarea>
                </div>
                <div class="form" style="margin-bottom: 15px;">
                    <label for="GenFunctionsInput">Описание процедуры проведения Итоговой Аттестации</label>
                    <textarea class="form-control" name="final_control" style="height: 120px" id="GenFunctionsInput" required>{{program.final_control|default_if_none:''}}</textarea>
                </div>
                <div class="form" style="margin-bottom: 15px;">
                    <label for="GenFunctionsInput">Характеристика материалов Итоговой Аттестации (с включением требований к оформлению и представлению материалов слушателями)</label>
                    <textarea class="form-control" name="final_control_matereils" style="height: 120px" id="GenFunctionsInput" required>{{program.final_control_matereils|default_if_none:''}}</textarea>
                </div>
                <div class="form" style="margin-bottom: 15px;">
                    <label for="GenFunctionsInput">Критерии оценивания для Итоговой Аттестации (описать условия, при которых слушатель считается аттестованным)</label>
                    <textarea class="form-control" name="final_control_criteria" style="height: 120px" id="GenFunctionsInput" required placeholder="">{{program.final_control_criteria|default_if_none:''}}</textarea>
                </div>
                <div class="form-floating  mb-3" style="width: 100%;">
                    <input type="input" class="form-control" id="ProgramscoreDaysInput" name="min_score" maxlength="50" value="{{program.min_score|default_if_none:''}}" placeholder="">
                    <label for="ProgramscoreDaysInput">Минимально необходимое количество баллов или оценка</label>
                </div> 
             </form>           
        </div>
        <div class="stage stage-2" data-stage="2" {% if current_stage == 2 %}style="display:block;"{%else%}style="display:none;"{%endif%}>
            <div class="stage-hdr">
                <h2>
                    {% if program.status != "2" %}
                        <img class="check-img" src="{% static 'education_centers/img/check.png' %}" alt="check-icon">
                    {% else %}
                        2. 
                    {% endif %}
                    Получаемая(-ые) компетенция (-ии) и/или трудовые функции
                </h2>
                <form action="{% url 'program_constractor' program.id %}" method="post">
                    {% if program.status == "2" %}
                        <button class="btn btn-primary" name="save-stage" value="2">Завершить этап</button>
                    {% endif %}
                </form>
            </div>
            <div class="competencies-list">
                {%if program.program_type != "DPOPK" %}
                    <form class='add-activity-form' action="{% url 'program_constractor' program.id %}" method="post">
                        <div class="form mb-3 w-25">
                            <input type="input" class="form-control" id="AssignedQualifInput" name="name" placeholder="Вид деятельности" maxlength="350" required>
                        </div>
                        <button class="btn btn-outline-primary" name="add-activity">Добавить вид деятельности</button>
                    </form>
                {% endif %}
                <table class="table">
                    <tr class="sticky-top"> 
                        {%if program.program_type != "DPOPK" %}
                            <th scope="col">Виды деятельности</th>
                        {% endif %}
                        <th scope="col">Компетенция</th>
                        <th scope="col">Знания</th>
                        <th scope="col">Умения</th>
                        <th scope="col">Практический опыт</th>
                    </tr>
                    {% for activity in program.activities.all %}
                        <tr>
                            {%if program.program_type != "DPOPK" %}
                                <td scope="row" rowspan="{{ activity|count_rows_activity}}">
                                    <a href="" data-bs-toggle="modal" data-bs-target="#ChangeActivityModal{{activity.id}}">
                                        {{ activity }}
                                    </a>
                                </td>
                            {% endif %}
                            {% for competence in activity.competencies.all %}    
                                <tr>                
                                    <td  rowspan="{{ competence|count_rows_competence}}" style="border-top: 0;">
                                        <a href="" data-bs-toggle="modal" data-bs-target="#ChangeCompetenceModal{{competence.id}}">
                                            {{ competence }}
                                        </a>
                                    </td>
                                    {% for indicator in competence.indicators.all %}
                                        <tr >
                                            <td><a href="" data-bs-toggle="modal" data-bs-target="#ChangeIndicatorsModal{{indicator.id}}" >{{activity.index}}.{{competence.code}}.{{indicator.index}} {{ indicator.knowledge }}</a></td>
                                            <td>{{activity.index}}.{{competence.code}}.{{indicator.index}} {{ indicator.skill }}</td>
                                            <td> {% if indicator.practice != "" %}{{activity.index}}.{{competence.code}}.{{indicator.index}} {{ indicator.practice }}{% else %}-{% endif %}</td>
                                        </tr>
                                        {% if forloop.last %}
                                            <tr>
                                                <td  colspan="3">
                                                    <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#AddIndicatorsModal{{competence.id}}">Добавить знание и умение</button>
                                                </td>
                                            </tr>
                                        {% endif %}
                                    {% empty %}
                                        <td colspan="3">
                                            <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#AddIndicatorsModal{{competence.id}}">Добавить знание и умение</button>
                                        </td>
                                    {% endfor %}
                                </tr>
                                {% if forloop.last %}
                                    <tr>
                                        <td scope="row" colspan="4">
                                            <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#AddCompetenceModal{{activity.id}}">Добавить компетенцию</button>
                                        </td>
                                    </tr>
                                {% endif %}
                            {% empty %}
                                <td scope="row" colspan="4">
                                    <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#AddCompetenceModal{{activity.id}}">Добавить компетенцию</button>
                                </td>
                            {% endfor %}
                        </tr>
                    {% empty %}
                        <td class="none-alert" colspan="5">Не добавлено ни одного вида деятельности</td>
                    {% endfor %}
                </table>
            </div>
            <div class="equipment-list">
                <div class="table-hdr">
                    <h3>Требования к материально-техническому обеспечению</h3>
                    <button class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#AddEquipmentModal">
                        Добавить МТО
                    </button>
                </div>
                <table class="table">
                    <tr class="sticky-top"> 
                        <th scope="col">Компетенция</th>
                        <th scope="col" class="col-center">Материально-техническое обеспечение, необходимое для освоения ПК</th>
                        <th></th>
                    </tr>
                    <tr>
                        {% for competence in competencies %}
                            <tr><td rowspan="{{ competence.equipments.all.count|add:1 }}">{{ competence }}</td> 
                            {% for equipment in competence.equipments.all %}
                                <tr>
                                    <td>{{ equipment }}</td>
                                    <td>
                                        <form action="{% url 'program_constractor' program.id %}" method="post">
                                            <input type="text" name="equipment_id" value="{{ equipment.id }}" style="display: none;">
                                            <input type="text" name="competence_id" value="{{ competence.id }}" style="display: none;">
                                            <input type="submit" class="btn btn-outline-danger" name="remove-equipment" value="Убрать">
                                        </form>
                                    </td>
                                </tr>
                            {% empty %}
                                <td class="none-alert" colspan="2">МТО не добавлено </td>
                            {% endfor %}
                            </tr>
                        {% empty %}
                            <td class="none-alert" colspan="3">Не добавлено ни одной компетенции</td>
                        {% endfor %}
                    </tr>
                </table>
            </div>
            
        </div>
        <div class="stage stage-3" data-stage="3" {% if current_stage == 3 %}style="display:block;"{%else%}style="display:none;"{%endif%}>
            <div class="stage-hdr">
                <h2>
                    {% if program.status != "3" %}
                        <img class="check-img" src="{% static 'education_centers/img/check.png' %}" alt="check-icon">
                    {% else %}
                        3. 
                    {% endif %}
                    Разработчики (составители) программы
                </h2>
                <form action="{% url 'program_constractor' program.id %}" method="post">
                    {% if program.status == "3" %}
                        <button class="btn btn-primary" name="save-stage" value="3">Завершить этап</button>
                    {% endif %}
                </form>
            </div>
            <div class="authors-list">
                <form class='add-activity-form' action="{% url 'program_constractor' program.id %}" method="post">
                    <div class="select-add">
                        <div class="form-floating mb-3 filter-selectpicker" style="gap: 10px; justify-content: flex-start;">
                            <select class="selectpicker" title="Разработчик программы" id="AuthorInput" data-live-search="true" name="author_id" required>
                                {%for author in authors %}  
                                    <option value="{{author.id}}" class="field">{{author}}</option>
                                {% endfor %}
                            </select>
                            <label for="AuthorInput">Разработчик программы</label>
                        </div>
                        <button class="btn btn-outline-primary" name="add-author">Добавить</button>
                        <div class="btn btn-outline-primary add-btn" data-bs-toggle="modal" data-bs-target="#AddAuthorModal">+</div>
                    </div>
                </form>
                <table class="table">
                    <tr class="sticky-top"> 
                        <th scope="col">ФИО</th>
                        <th scope="col">Должность</th>
                        <th scope="col">Степень</th>
                        <th scope="col">Место работы</th>
                        <th scope="col">Убрать?</th>
                    </tr>
                    {% for author in program.authors.all %}
                        <tr>
                            <td scope="row">{{ author.name }}</td>
                            <td scope="row">{{ author.position }}</td>
                            <td scope="row">{{ author.degree }}</td>
                            <td scope="row">{{ author.place_of_work }}</td>
                            <td>
                                <form action="{% url 'program_constractor' program.id %}" method="post">
                                    <input type="text" name="author_id" value="{{ author.id }}" style="display: none;">
                                    <input type="submit" class="btn btn-outline-danger" name="remove-author" value="Убрать">
                                </form>
                            </td>
                        </tr>
                    {% empty %}
                        <tr>
                            <td class="none-alert" colspan="5">Не добавлено ни одного разработчика</td>
                        </tr>
                    {% endfor %}
                </table>
            </div>
        </div>
        <div class="stage stage-4" data-stage="4" {% if current_stage == 4 %}style="display:block;"{%else%}style="display:none;"{%endif%}>
            <div class="stage-hdr">
                <h2>
                    {% if program.status != "4" %}
                        <img class="check-img" src="{% static 'education_centers/img/check.png' %}" alt="check-icon">
                    {% else %}
                        4. 
                    {% endif %}
                    Учебно-тематический план
                </h2>
                
                
                <form action="{% url 'program_constractor' program.id %}" method="post">
                    {% if program.status == "4"  %}
                        <button class="btn btn-primary {% if program.duration != program.get_full_duration %}disabled{% endif %}" name="save-stage" value="4">Завершить этап</button>
                    {% endif %}
                </form>
            </div>
            <div class="ed-theme-plan">
                <div class="action-panel">
                    <form class='add-module-form' action="{% url 'program_constractor' program.id %}" method="post">
                        <div class="form mb-3 module-name">
                            <input type="input" class="form-control" id="moduleNameInput" name="name" placeholder="Название модуля" maxlength="350" required>
                        </div>
                        <button class="btn btn-primary" name="add-module">Добавить модуль</button>
                    </form>     
                    <button class="btn btn-outline-primary " data-bs-toggle="modal" data-bs-target="#ImportModal">Импортировать</button>              
                </div>
                <div class="alert alert-info w-90" role="alert">
                    В случае прохождения промежуточной или итоговой аттестации в форме тестирования – часы заносятся в столбец "Сам. работа"; в случае прохождения промежуточной или итоговой аттестации в форме защиты проектной работы – часы заносятся в столбец "Практика".
                </div>
                <table class="table" style=" border-collapse: separate; border-spacing: 0;">
                    <tr class="sticky-top"> 
                        <th scope="col">Модуль/Тема</th>
                        <th scope="col" class="col-center">Форма<br>аттестации</th>
                        <th></th>
                        <th scope="col" class="col-center">Лекции</th>
                        <th scope="col" class="col-center">Практика</th>
                        <th scope="col" class="col-center">Консультации</th>
                        <th scope="col" class="col-center">Сам. работа</th>
                        <th scope="col" class="col-center">Итого</th>
                    </tr>
                    {% for module in program.modules.all %}
                        <tr class="module-tr">
                            <form style="display: none;" action="{% url 'program_constractor' program.id %}" method="post">
                                <td>
                                    <div class="module">
                                        <div class="module-name">{{ module }}</div>
                                        <div class="form mb-3 change-module-input" style="display: none; margin-bottom: 0 !important;">
                                            <input type="input" class="form-control" id="moduleNameInput" name="name" value="{{ module.name }}" placeholder="Название модуля" maxlength="350" required>
                                        </div>
                                    </div>
                                </td>
                                <td class="col-center">
                                    <input style="display: none;" type="text" name="module_id" value="{{ module.id }}">
                                    <button class="btn btn-primary change-module-btn" style="display: none; margin: auto;" name='change-module'>
                                        Сохранить
                                    </button>
                                </td>
                            </form>
                            <td>
                                <div class='row-options'>
                                    <div class="edit-btn edit-module-btn">
                                        <img src="{% static 'federal_empl_program/img/edit-icon.svg' %}" alt="edit-icon">
                                    </div>
                                    <form style="display: none;" action="{% url 'program_constractor' program.id %}" method="post">
                                        <input style="display: none;" type="text" name="module_id" value="{{ module.id }}">
                                        <button class=delete-btn name="delete-module">
                                            <img src="{% static 'federal_empl_program/img/trash-icon.png' %}" alt="delete-icon">
                                        </button>
                                    </form>
                                </div>
                            </td>
                            <td class="col-center">{{ module.get_lection_duration|default_if_none:'0' }} ак.ч.</td>
                            <td class="col-center">{{ module.get_practice_duration|default_if_none:'0' }} ак.ч.</td>
                            <td class="col-center">{{ module.get_consultations_duration|default_if_none:'0' }} ак.ч.</td>
                            <td class="col-center">{{ module.get_independent_duration|default_if_none:'0' }} ак.ч.</td>
                            <td class="col-center">{{ module.get_full_duration }} ак.ч.</td>
                            
                        </tr>
                            {% for subject in module.subjects.all %}
                                <tr class="subject-tr">
                                    <td style="padding-left: 25px;">{{ subject }}</td>
                                    <td class="col-center">{{ subject.attest_form }}</td>
                                    <td>
                                        <div class='row-options'>
                                            <div class="edit-btn" data-bs-toggle="modal" data-bs-target="#ChangeSubjectModal{{subject.id}}">
                                                <img src="{% static 'federal_empl_program/img/edit-icon.svg' %}" alt="edit-icon">
                                            </div>
                                        </div>
                                    </td>
                                    <td class="col-center">{{ subject.lections_duration }} ак.ч.</td>
                                    <td class="col-center">{{ subject.practice_duration }} ак.ч.</td>
                                    <td class="col-center">{{ subject.consultations_duration }} ак.ч.</td>
                                    <td class="col-center">{{ subject.independent_duration }} ак.ч.</td>
                                    <td class="col-center">{{ subject.get_full_duration }} ак.ч.</td>
                                </tr>
                            {% endfor %}
                            <tr>
                                <td style="padding: 10px 25px;" colspan="8">
                                    <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#AddSubjectModal{{module.id}}">
                                        Добавить тему
                                    </button>
                                    {% if module.attest_form is None %}
                                        <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#AddInterimExModal{{module.id}}">
                                            Добавить аттестацию
                                        </button>
                                    {% endif %}
                                </td>
                            </tr>
                            {% if module.attest_form is not None %}
                                <tr class="module-tr">
                                    <td style="padding-left: 25px;">Промежуточная аттестация</td>
                                    <td class="col-center">{{ module.attest_form }}</td>
                                    <td>
                                        <div class='row-options'>
                                            <div class="edit-btn" data-bs-toggle="modal" data-bs-target="#AddInterimExModal{{module.id}}">
                                                <img src="{% static 'federal_empl_program/img/edit-icon.svg' %}" alt="edit-icon">
                                            </div>
                                        </div>
                                    </td>
                                    <td class="col-center">{{ module.lections_duration }} ак.ч.</td>
                                    <td class="col-center">{{ module.practice_duration }} ак.ч.</td>
                                    <td class="col-center">{{ module.consultations_duration }} ак.ч.</td>
                                    <td class="col-center">{{ module.independent_duration }} ак.ч.</td>
                                    <td class="col-center">{{ module.get_ex_duration }} ак.ч.</td>
                                </tr>
                            {% endif %}
                        {% endfor %}
                    <tfoot class="plan-summary">
                        <tr class="">
                            {% if program.exam_attest_form is None %}
                                <td>
                                    <button class="btn btn btn-primary" data-bs-toggle="modal" data-bs-target="#AddExModal">
                                        Добавить Итоговую аттестацию
                                    </button>
                                </td>
                            {% else %}
                                <td>Итоговая аттестация</td>
                                <td class="col-center">{{ program.exam_attest_form }}</td>
                                <td>
                                    <div class='row-options'>
                                        <div class="edit-btn" data-bs-toggle="modal" data-bs-target="#AddExModal">
                                            <img src="{% static 'federal_empl_program/img/edit-icon.svg' %}" alt="edit-icon">
                                        </div>
                                    </div>
                                </td>
                                <td class="col-center">{{ program.exam_lections_duration }} ак.ч.</td>
                                <td class="col-center">{{ program.exam_practice_duration }} ак.ч.</td>
                                <td class="col-center">{{ program.exam_consultations_duration }} ак.ч.</td>
                                <td class="col-center">{{ program.exam_independent_duration }} ак.ч.</td>
                                <td class="col-center">{{ program.get_full_ex_duration }} ак.ч.</td>
                            {% endif %}
                        </tr>
                        <tr class="sticky-bottom">
                            <td colspan="3">Всего ак. часов</td>
                            <td class="col-center">{{ program.get_lections_duration }} ак.ч.</td>
                            <td class="col-center">{{ program.get_practice_duration }} ак.ч.</td>
                            <td class="col-center">{{ program.get_consultations_duration }} ак.ч.</td>
                            <td class="col-center">{{ program.get_independent_duration }} ак.ч.</td>
                            <td class="col-center">{{ program.get_full_duration }}/{{ program.duration }} ак.ч.</td>
                        </tr>
                    </tfoot>
                    
                </table>
            </div>
        </div>
        <div class="stage stage-5" data-stage="5" {% if current_stage == 5 %}style="display:block;"{%else%}style="display:none;"{%endif%}>
            <div class="stage-hdr">
                <h2>
                    {% if program.status != "5" %}
                        <img class="check-img" src="{% static 'education_centers/img/check.png' %}" alt="check-icon">
                    {% else %}
                        5. 
                    {% endif %}
                    Учебно-тематический план
                </h2>
                <form action="{% url 'program_constractor' program.id %}" method="post">
                    {% if program.status == "5" %}
                        <button class="btn btn-primary" name="save-stage" value="5">Завершить этап</button>
                    {% endif %}
                </form>
            </div>
        </div>
        <div class="stage stage-6" data-stage="6" {% if current_stage == 6 %}style="display:block;"{%else%}style="display:none;"{%endif%}>
            <div class="stage-hdr">
                <h2>
                    {% if program.status != "6" %}
                        <img class="check-img" src="{% static 'education_centers/img/check.png' %}" alt="check-icon">
                    {% else %}
                        6. 
                    {% endif %}
                    Требования к информационному и учебно-методическому обеспечению
                </h2>
                <form action="{% url 'program_constractor' program.id %}" method="post">
                    {% comment %} {% if program.status == "6" %}
                        <button class="btn btn-primary" name="save-stage" value="6">Завершить этап</button>
                    {% endif %} {% endcomment %}
                </form>
            </div>
            <div>
                <div class=action-panel>
                    <form class='add-module-form' action="{% url 'program_constractor' program.id %}" method="post">
                        <div class="form mb-3 w-25">
                            <input type="input" class="form-control" id="moduleNameInput" name="name" placeholder="Название" maxlength="350" required>
                        </div>
                        <div class="form mb-3 filter-selectpicker" style="gap: 10px; justify-content: flex-start;">
                            <select class="selectpicker" title="Тип документа" id="AuthorInput" data-live-search="true" name="doc_type" required>
                                <option value="LAW" class="field">Нормативные правовые акты, иная документация</option>
                                <option value="MAIN" class="field">Основная литература</option>
                                <option value="ADD" class="field">Дополнительная литература</option>
                                <option value="INT" class="field">Интернет-ресурсы</option>
                                <option value="LIB" class="field">Электронно-библиотечная система</option>
                            </select>
                        </div>
                        <button class="btn btn-outline-primary" name="add-doc">Добавить документ</button>
                    </form>                   
                </div>
                <div class="alert alert-info w-90" role="alert">
                    Оформление раздела должно соответствовать требованиям ГОСТ Р 7.0.100-2018. Национальный стандарт Российской Федерации. Система стандартов по информации, библиотечному и издательскому делу. Библиографическая запись. Библиографическое описание. Общие требования и правила составления.
                    Можете воспользоваться <a href="https://moluch.ru/snoska/" target="_blank">сервисом для оформления ссылок</a>.
                </div>
                <table class="table">
                    <tr class="sticky-top"> 
                        <th scope="col">Документ</th>
                        <th scope="col">Типология</th>
                        <th>Удалить?</th>
                    </tr>
                    {% for doc in program.documentation.all %}
                        <tr>
                            <td>{{ doc.name }}</td>
                            <td>{{ doc.get_doc_type_display }}</td>
                            <td style="justify-content: center;">
                                <form action="{% url 'program_constractor' program.id %}" method="post">
                                    <input style="display: none;" type="text" name="doc_id" value="{{ doc.id }}">
                                    <button class=delete-btn name="delete-doc">
                                        <img src="{% static 'federal_empl_program/img/trash-icon.png' %}" alt="delete-icon">
                                    </button>
                                </form>
                            </td>
                        </tr>
                    {% empty %}
                    <tr>
                        <td class="none-alert" colspan="3">Не добавлено ни одного разработчика</td>
                    </tr>
                    {% endfor %}
                </table>
            </div>
        </div>
    </div>
{% endblock %}