{% extends "layout.html" %}
{% load static %}

{% block title %}Личный кабинет ЦО{% endblock %}
{% block style %}
        <link href="{% static 'education_centers/css/ed_center_groups.css' %}" rel="stylesheet">
{% endblock %}
{% block script %}
{% endblock %}

{% block body %}
    <div class="edcenter-profile">
        <div class="edcenter-card">
            <h1>{{ed_center}}</h1>
            <div class="test-forms">
                <form action="{% url 'ed_center_groups' ed_center.id %}" method="POST">
                    <input class="btn btn-primary" type="submit" name="create_contract" value="Договор">
                </form>
                <div>
                    <form action="{% url 'ed_center_groups' ed_center.id %}" method="post">
                        <div class="form mb-3">
                            <select class="selectpicker" title="Выберите группы" multiple data-live-search="true" name="groups" required>
                                {% for group in groups %}
                                    <option value="{{group.id}}">{{group.id}}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <input type="submit" class="btn btn-primary" name="create_assignment" value="Задание">
                    </form>
                </div>
                <div>
                    <form action="{% url 'ed_center_groups' ed_center.id %}" method="post">
                        <div class="form mb-3">
                            <select class="selectpicker" title="Выберите задание" data-live-search="true" name="assignment" required>
                                {% for assigment in assigments %}
                                    <option value="{{assigment.id}}">{{assigment}}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <input type="submit" class="btn btn-primary" name="create_act" value="Акт">
                    </form>
                </div>
                <div>
                    <form action="{% url 'ed_center_groups' ed_center.id %}" method="post">
                        <div class="form mb-3">
                            <select class="selectpicker" title="Выберите акт" data-live-search="true" name="act" required>
                                {% for act in acts %}
                                    <option value="{{act.id}}">{{act}}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <input type="submit" class="btn btn-primary" name="create_students_list" value="Список">
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div class="documents">
        <div class="doc-table">
            <h2>Документы по группам</h2>
            <table class="table">
                <tr class="sticky-top"> 
                    <th scope="col">Задание на оказание услуг</th>
                    <th scope="col">Учебные группы</th>
                    <th scope="col">Список лиц, завершивших обучение</th>
                    <th scope="col">Акт выполненных работ</th>
                    <th scope="col">Счет на оплату</th>
                </tr>
                {% for contract in contracts %}
                    {% for assigment in contract.children_docs.all %}
                        {% for act in assigment.children_docs.all %}
                            {% for group in act.groups.all %}
                                {% if forloop.parentloop.parentloop.counter|divisibleby:2 %}
                                    <tr>
                                {% else %}
                                    <tr class="colored-row">
                                {% endif %}
                                    {% if forloop.first and forloop.parentloop.first %}
                                        <td scope="row" rowspan="{{ assigment.groups.all|length }}">Задание №{{ assigment.register_number }} от 25.04.2023</td>
                                    {% endif %}
                                    <td scope="row">Группа №{{ group.name }}</td>
                                    <td scope="row">Cформировать список</td>
                                    {% if forloop.first %}
                                        <td scope="row" rowspan="{{ act.groups.all|length }}">Акт №{{ act.register_number }} от 25.04.2023</td>
                                        <td scope="row" rowspan="{{ act.groups.all|length }}">Загрузить счёт</td>
                                    {% endif %}
                                </tr>
                            {% endfor %}
                        {% endfor %}
                        {% if assigment.children_docs.all.count == 0 %}
                            {% for group in assigment.groups.all %}
                                {% if forloop.parentloop.counter|divisibleby:2 %}
                                    <tr>
                                {% else %}
                                    <tr class="colored-row">
                                {% endif %}
                                    {% if forloop.first %}
                                        <td scope="row" rowspan="{{ assigment.groups.all|length }}">Задание №{{ assigment.register_number }} от 25.04.2023</td>
                                    {% endif %}
                                    <td scope="row">Группа №{{ group.name }}</td>
                                    <td scope="row">Cформировать список</td>
                                    {% if forloop.first %}
                                        <td scope="row" rowspan="{{ assigment.groups.all|length }}">Сформировать акт</td>
                                        <td scope="row" rowspan="{{ assigment.groups.all|length }}">Загрузить счёт</td>
                                    {% endif %}
                                </tr>
                            {% endfor %}
                        {% endif %}
                    {% endfor %}
                {% endfor %}
            </table>    
        </div>
    </div>
{% endblock %}