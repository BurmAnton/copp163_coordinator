{% extends "vocational_guidance/layout.html" %}
{% load static %}
{% block title %}Список проб | Билет в будущее{% endblock %}

{% block style %}
        <link href="{% static 'vocational_guidance/css/students_list.css' %}" rel="stylesheet">
{% endblock %}

{% block script %}
{% endblock %}

{% block body %}
    <div class="section students-section">
        <div class="container">
            <div class="row row-cols-3 g-3">
                <div class="col-12 justify-content-center text-center">
                    <h1>Список учеников {{school.name}}</h1>
                </div>
                <table class="table table-striped">
                        <tr class="sticky-top">
                            <th scope="col">ФИО</th>
                            <th scope="col">Email</th>
                            <th scope="col">Проба</th>
                            <th scope="col" class="text-center">Прошёл пробу</th>
                        </tr>
                        {% for key, value in students.items %}
                                <tr class="class-row"><td colspan="5" scope="row">{{key.grade_number}}{{key.grade_letter}} класс</td></tr>
                                {% for student in value %}
                                    <div class="modal fade" id="ChangeStudent{{student.id}}Modal" tabindex="-1" aria-labelledby="ChangeStudent{{student.id}}ModalLabel" aria-hidden="true">
                                        <div class="modal-dialog">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title">Изменить данные профиля</h5>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                </div>
                                                <form action="{% url 'change_profile_student' %}" method="post">
                                                    <div class="modal-body">
                                                        <div class="form-floating mb-3">
                                                            <input type="input" class="form-control" name="name" id="Name" placeholder="Имя" value="{{student.first_name}}" required>
                                                            <label for="Name">Имя</label>
                                                        </div>
                                                        <div class="form-floating mb-3">
                                                            <input type="input" class="form-control" name="middle_name" id="MiddleName" placeholder="Отчество" value="{{student.middle_name}}">
                                                            <label for="MiddleName">Отчество</label>
                                                        </div>
                                                        <div class="form-floating mb-3">
                                                            <input type="input" class="form-control" name="last_name" id="LastName" placeholder="Фамилия" value="{{student.last_name}}" required>
                                                            <label for="LastName">Фамилия</label>
                                                        </div>
                                                        <div class="form-floating mb-3">
                                                            <input type="date" class="form-control" name="birthday" id="Birthday" placeholder="Дата рождения" value="{{student.birthday.isoformat}}" required>
                                                            <label for="Birthday">Дата рождения</label>
                                                        </div>
                                                        <div class="form-floating mb-3" style="display: none;">
                                                            <input type="input" class="form-control" name="school" id="School{{student.id}}" placeholder="Дата рождения" value="{{student.school.id}}" required>
                                                        </div>              
                                                        <div class="form mb-3">
                                                            <div class="row g-3">
                                                                <div class="col">
                                                                    <select class="form-control" name="school_class" id="school_class" required>
                                                                            <option value="{{student.school_class.grade_number}}">{{student.school_class.grade_number}}</option>
                                                                        {% if student.school_class.grade_number != 6 %}
                                                                            <option value="6">6</option>
                                                                        {% endif %}
                                                                        {% if student.school_class.grade_number != 7 %}
                                                                            <option value="7">7</option>
                                                                        {% endif %}
                                                                        {% if student.school_class.grade_number != 8 %}
                                                                            <option value="8">8</option>
                                                                        {% endif %}
                                                                        {% if student.school_class.grade_number != 9 %}
                                                                            <option value="9">9</option>
                                                                        {% endif %}
                                                                        {% if student.school_class.grade_number != 10 %}
                                                                            <option value="10">10</option>
                                                                        {% endif %}
                                                                        {% if student.school_class.grade_number != 11 %}
                                                                            <option value="11">11</option>
                                                                        {% endif %}
                                                                    </select>
                                                                </div>
                                                                <div class="col">
                                                                    <input type="input" class="form-control" name="school_class_latter" id="school_class_latter" placeholder="Буква класса" value="{{student.school_class.grade_letter}}" required>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="form-floating mb-3">
                                                            <input type="email" class="form-control" name="email" id="Email" placeholder="Email" value="{{student.email}}" required>
                                                            <label for="Email">Email</label>
                                                        </div>
                                                        <div class="form-floating mb-3" style="display: none;"> 
                                                            <input type="email" class="form-control" name="email_old" id="Email_old" placeholder="Email" value="{{student.email}}" required>
                                                        </div>
                                                        <div class="form-floating mb-3">
                                                            <input type="phone2numeric" class="form-control" name="phone" id="Phone" placeholder="Номер телефона" value="{{student.phone_number}}" required>
                                                            <label for="Phone">Номер телефона</label>
                                                        </div>
                                                        <div class="form-check" style="display:none;">
                                                            {% if student.disability_type == none %}
                                                                <input class="form-check-input" type="checkbox" id="disability-check" name="disability-check">
                                                            {% else %}
                                                                <input class="form-check-input" type="checkbox" id="disability-check" name="disability-check" checked>
                                                            {% endif %}
                                                            <label class="form-check-label" for="flexCheckDefault">
                                                                Я отношусь к лицам с ОВЗ
                                                            </label>
                                                        </div>
                                                        {% if student.disability_type == none %}
                                                            <div class="form mb-3" id="form-disability" style="display:none;">
                                                        {% else %}
                                                            <div class="form mb-3" id="form-disability" style="display:none;">
                                                        {% endif %}
                                                            <select class="selectpicker" data-width="100%" data-live-search="true" name="disability_type" id="disability_type">
                                                                {% if student.disability_type != none %}
                                                                    {% for type in disability_types %}
                                                                        {% if student.disability_type == type %}
                                                                            <option value="{{type.id}}" class="disability_type" data-school="{{type}}" selected>{{type.name}}</option>
                                                                        {% else %}
                                                                            <option value="{{type.id}}" class="disability_type" data-school="{{type}}">{{type.name}}</option>
                                                                        {% endif %}
                                                                    {% endfor %}
                                                                {% else %}
                                                                    <option>Выберите вид нарушения</option>
                                                                    {% for type in disability_types %}
                                                                            <option value="{{type.id}}" class="disability_type" data-school="{{type}}">{{type.name}}</option>
                                                                    {% endfor %}
                                                                {% endif %}
                                                            </select>
                                                                <div class="invalid-feedback">Example invalid select feedback</div>
                                                        </div>
                                                        <div style="display: none;">
                                                            <input type="input" class="form-control" name="id" value="{{student.id}}">
                                                        </div>
                                                    </div>
                                                    <div class="modal-footer">
                                                        <div class="d-grid gap-2">
                                                            <button type="submit" class="btn btn-primary">Сохранить изменения</button>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                    <tr class="ALL school {{adm_ter.3}}">
                                        <td scope="row" class="name-row">
                                            <img class="edit-img" src="{% static 'vocational_guidance/img/edit.png' %}" id="ChangeStudent{{student.id}}Triger" data-bs-toggle="modal" data-bs-target="#ChangeStudent{{student.id}}Modal">
                                            {{student.last_name}} 
                                            {{student.first_name}} 
                                            {{student.middle_name}}
                                        </td>
                                        <td scope="row">{{student.email}}</td>
                                        {%if student.voc_guid_groups.all%}
                                            <td scope="row">{{student.voc_guid_groups.all.last.bundle.name}}</td>
                                        {% else %}
                                            <td scope="row">–</td>
                                        {% endif %}
                                        {% if student.voc_guid_assessment.all.last.attendance %}
                                            <td scope="row" class="text-center">
                                                <img class="atendace-img" src="{% static 'vocational_guidance/img/ok.png' %}">
                                            </td>
                                        {% else %}
                                            <td scope="row" class="text-center">
                                                <img class="atendace-img" src="{% static 'vocational_guidance/img/not.png' %}">
                                            </td>
                                        {% endif %}
                                    </tr>
                                {% endfor %}
                        {% endfor %}
                    </table>
            </div>
        </div>
</div>
    

{% endblock %}
