{% extends "vocational_guidance/layout.html" %}
{% load static %}
{% block title %}Личный кабинет | Билет в будущее{% endblock %}

{% block style %}
        <link href="{% static 'vocational_guidance/css/index.css' %}" rel="stylesheet">
{% endblock %}

{% block script %}
    <script src="{% static 'vocational_guidance/js/index.js' %}"></script>
{% endblock %}

{% block body %}
    <div class="modal fade" id="ChangePasswordModal" tabindex="-1" aria-labelledby="ChangePasswordModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Изменить данные профиля</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form action="{% url 'change_password' %}" method="post">
                    <div class="modal-body">
                        <div class="form-floating mb-3">
                            <input type="password" class="form-control" name="current_password" id="Сonfirmation" placeholder="Пароль" required>
                            <label for="InputPassword">Введите текущий пароль</label>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="password" class="form-control" name="password" id="InputPassword" placeholder="Пароль" required>
                            <label for="InputPassword">Придумайте новый пароль</label>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="password" class="form-control" name="confirmation" id="Сonfirmation" placeholder="Пароль" required>
                            <label for="InputPassword">Повторите новый пароль</label>                        
                        </div>
                    </div>
                    <div class="modal-footer">
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary">Сменить пароль</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal fade" id="ChangeProfileModal" tabindex="-1" aria-labelledby="ChangeProfileModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Изменить данные профиля</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form action="{% url 'change_profile' %}" method="post">
                    <div class="modal-body">
                        <div class="form-floating mb-3">
                            <input type="input" class="form-control" name="name" id="Name" placeholder="Имя" value="{{user.first_name}}" required>
                            <label for="Name">Имя</label>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="input" class="form-control" name="middle_name" id="MiddleName" placeholder="Отчество" value="{{user.middle_name}}">
                            <label for="MiddleName">Отчество</label>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="input" class="form-control" name="last_name" id="LastName" placeholder="Фамилия" value="{{user.last_name}}" required>
                            <label for="LastName">Фамилия</label>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="date" class="form-control" name="birthday" id="Birthday" placeholder="Дата рождения" value="{{birthday}}" required>
                            <label for="Birthday">Дата рождения</label>
                        </div>
                        <div class="form mb-3">
                            <select class="selectpicker" data-width="100%" data-live-search="true" name="school" id="School" required>
                                <option value="{{user.school.id}}">{{user.school.name}}</option>
                                {% for school in schools %}
                                    <option value="{{school.id}}">{{school.name}}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form mb-3">
                            <div class="row g-3">
                                <div class="col">
                                    <select class="form-control" name="school_class" id="school_class" required>
                                            <option value="{{user.school_class.grade_number}}">{{user.school_class.grade_number}}</option>
                                        {% if user.school_class.grade_number != 6 %}
                                            <option value="6">6</option>
                                        {% endif %}
                                        {% if user.school_class.grade_number != 7 %}
                                            <option value="7">7</option>
                                        {% endif %}
                                        {% if user.school_class.grade_number != 8 %}
                                            <option value="8">8</option>
                                        {% endif %}
                                        {% if user.school_class.grade_number != 9 %}
                                            <option value="9">9</option>
                                        {% endif %}
                                        {% if user.school_class.grade_number != 10 %}
                                            <option value="10">10</option>
                                        {% endif %}
                                        {% if user.school_class.grade_number != 11 %}
                                            <option value="11">11</option>
                                        {% endif %}
                                    </select>
                                </div>
                                <div class="col">
                                    <input type="input" class="form-control" name="school_class_latter" id="school_class_latter" placeholder="Буква класса" value="{{user.school_class.grade_letter}}" required>
                                </div>
                            </div>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="email" class="form-control" name="email" id="Email" placeholder="Email" value="{{user.email}}" required>
                            <label for="Email">Email</label>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="phone2numeric" class="form-control" name="phone" id="Phone" placeholder="Номер телефона" value="{{user.phone_number}}" required>
                            <label for="Phone">Номер телефона</label>
                        </div>
                        <div class="form-check">
                            {% if user.disability_type == none %}
                                <input class="form-check-input" type="checkbox" id="disability-check" name="disability-check">
                            {% else %}
                                <input class="form-check-input" type="checkbox" id="disability-check" name="disability-check" checked>
                            {% endif %}
                            <label class="form-check-label" for="flexCheckDefault">
                                Я отношусь к лицам с ОВЗ
                            </label>
                        </div>
                        {% if user.disability_type == none %}
                            <div class="form mb-3" id="form-disability" style="display:none;">
                        {% else %}
                            <div class="form mb-3" id="form-disability">
                        {% endif %}
                            <select class="selectpicker" data-width="100%" data-live-search="true" name="disability_type" id="disability_type">
                                {% if user.disability_type != none %}
                                {% for type in disability_types %}
                                    {% if user.disability_type == type.0 %}
                                        <option value="{{type.0}}" class="disability_type" data-school="{{type}}" selected>{{type.1}}</option>
                                    {% else %}
                                        <option value="{{type.0}}" class="disability_type" data-school="{{type}}">{{type.1}}</option>
                                    {% endif %}
                                {% endfor %}
                                {% else %}
                                    <option>Выберите вид нарушения</option>
                                    {% for type in disability_types %}
                                            <option value="{{type.0}}" class="disability_type" data-school="{{type}}">{{type.1}}</option>
                                    {% endfor %}
                                {% endif %}
                            </select>
                                <div class="invalid-feedback">Example invalid select feedback</div>
                        </div>
                        <div style="display: none;">
                            <input type="input" class="form-control" name="id" value="{{user.id}}">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary">Сохранить изменения</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="section profile-section">
        <div class="container-xxl">
            <div class="row row-cols-3 g-3">
                <div class="col-12 justify-content-center text-left">
                    <div class="row row-cols-6 g-5">
                        <div class="col-5">
                            <div class="card card-profile border-dark">
                                <h2 class="card-header border-dark">
                                    Мой профиль
                                </h2>
                                <div class="card-body border-dark">
                                    <h5>{{user.last_name}} {{user.first_name}} {{user.middle_name}}</h5>
                                    <ul class="list-group list-group-flush">
                                        <li class="list-group-item"><b>Email:</b> {{user.email}}</li>
                                        <li class="list-group-item"><b>Номер телефона:</b> {{user.phone_number}}</li>
                                        <li class="list-group-item"><b>Дата рождения:</b> {{user.birthday}}</li>
                                        <li class="list-group-item"><b>Школа:</b> {{user.school.name}}</li>
                                        <li class="list-group-item"><b>Класс:</b> {{user.school_class.grade_number}}{{user.school_class.grade_letter}}</li>
                                    </ul>
                                </div>
                                <div class="card-footer text-end border-dark">
                                    <div class="d-grid gap-2 d-md-block">
                                        <button type="button" class="btn border-secondary" id="Change_password" data-bs-toggle="modal" data-bs-target="#ChangePasswordModal">Сменить пароль</button>
                                        <button type="button" class="btn btn-primary" id="Change_profile" data-bs-toggle="modal" data-bs-target="#ChangeProfileModal">
                                            Изменить личные данные
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-7">
                            <h2>
                                Выбранные профориентационные мероприятия
                            </h2>
                            <div class="row row-cols-2 g-3">
                            {% for key, value in choosen_bundles.items %}
                                    {% for bundle_key, bundle_value in value.items %}
                                        <div class="col-12">
                                            <div class="card h-100">
                                                <div class="card-body">
                                                    <h5 class="card-title">{{bundle_value|get_item:'name'}}</h5>
                                                    <p class="card-text">{{bundle_value|get_item:'description'}}</p>
                                                </div>
                                                <div class="card-footer">
                                                    <div class="d-grid gap-2">
                                                        <form action="{%url 'reject_bundle' %}" method="post">
                                                            <input type="input" class="form-control" name="citizen" value="{{user.id}}" style="display: none;">
                                                            <input type="input" class="form-control" name="bundle_id" value="{{bundle_value|get_item:'id'}}" style="display: none;">
                                                            <div class="d-grid gap-2">
                                                                <button type="submit" class="btn btn-outline-dark">Отказаться</button>
                                                            </div>
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    {% endfor %}
                                {% endfor %}
                            </div>
                            <p>{{message}}</p> 
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% if 'SPO' in type_presence %}
        <div class="section park-section">
            <div class="container">
                <div class="row row-cols-3 gx-0 gy-4">
                    <div class="col-12 justify-content-center text-center">
                        <h2>Профессиональные пробы на площадке исторический парк «Россия – Моя история» </h2>
                        <p>Обучающиеся 6-11 классов школ Самарской области могут бесплатно пройти три мероприятия профессионального выбора на площадке исторического парка «Россия – Моя история» г. Самара, ул. Красноармейская, 131, (этаж 3). Первое мероприятие - экскурсия по профориентационной тематике по восьми станциям (по средам деятельности). 
                            Второе и третье мероприятия - профессиональные пробы по компетенциям WorldSkills, на которых обучающиеся выполнят практические задания. Обучающийся может выбрать один из девяти наборов компетенции, каждый набор включает две профессиональные пробы по разным компетенциям.
                            Длительность одного мероприятия  — 1 час. 
                        </p> 
                    </div>
                    {% for key, value in bundles.items %}
                        {% if key == "SPO" %}
                            {% for bundle_key, bundle_value in value.items %}
                                <div class="col">
                                    <div class="card h-100">
                                        <img src="{{bundle_value|get_item:'img_link'}}" class="card-img-top" alt="...">
                                        <div class="card-body">
                                            <h5 class="card-title">{{bundle_value|get_item:'name'}}</h5>
                                            <p class="card-text">{{bundle_value|get_item:'description'}}</p>
                                            <p></p>
                                        </div>
                                        <div class="card-footer">
                                            <div class="d-grid gap-2">
                                                <form action="{%url 'choose_bundle' %}" method="post">
                                                    <input type="input" class="form-control" name="citizen" value="{{user.id}}" style="display: none;">
                                                    <input type="input" class="form-control" name="bundle_id" value="{{bundle_value|get_item:'id'}}" style="display: none;">
                                                    <div class="d-grid gap-2">
                                                        {% if 'SPO' in choosen_type_presence %}
                                                            <button type="submit" class="btn btn-outline-primary">Сменить пробу</button>
                                                        {% else %}
                                                            <button type="submit" class="btn btn-primary">Выбрать</button>
                                                        {% endif %}
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>
    {% endif %}
    {% if 'VO' in type_presence %}
        <div class="section online-section">
            <div class="container">
                <div class="row row-cols-3 g-3">
                    <div class="col-12 justify-content-center text-center">
                        <h2>Профессиональны пробы в рамках федерального проекта «Билет в будущее» </h2>
                        <p>Ученики школ Самарской области с 6 по 11 класс могут принять участии в мероприятиях профессионального выбора в рамках проекта «Билет в будущее». Все мероприятия будут проходить онлайн в связи с эпидемиологической ситуацией, длительность одного мероприятия – 90 минут.</p> 
                    </div>
                    {% for key, value in bundles.items %}
                        {% if key == "VO" %}
                            {% for bundle_key, bundle_value in value.items %}
                                <div class="col">
                                    <div class="card h-100">
                                        <!--<img src="{{bundle_value|get_item:'img_link'}}" class="card-img-top" alt="...">
                                        -->
                                        <div class="card-body">
                                            <h5 class="card-title">{{bundle_value|get_item:'name'}}</h5>
                                            <p class="card-text">{{bundle_value|get_item:'description'}}</p>
                                            <!--<a href="{{bundle_value|get_item:'education_program_link'}}" target="_blank">
                                                Программа подготовки
                                            </a>-->
                                            <ul class="list-group list-group-flush">
                                                <li class="list-group-item"></li>
                                                <li class="list-group-item ed_center"><b>Центр обучения:</b> {{bundle_value|get_item:'education_center'}}</li>
                                            </ul>
                                        </div>
                                        <div class="card-footer">
                                            <div class="d-grid gap-2">
                                                <form action="{%url 'choose_bundle' %}" method="post">
                                                    <input type="input" class="form-control" name="citizen" value="{{user.id}}" style="display: none;">
                                                    <input type="input" class="form-control" name="bundle_id" value="{{bundle_value|get_item:'id'}}" style="display: none;">
                                                    <div class="d-grid gap-2">
                                                        {% if 'VO' in choosen_type_presence %}
                                                            <button type="submit" class="btn btn-outline-primary">Сменить пробу</button>
                                                        {% else %}
                                                            <button type="submit" class="btn btn-primary">Выбрать</button>
                                                        {% endif %}
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>
    {% endif %}
{% endblock %}
